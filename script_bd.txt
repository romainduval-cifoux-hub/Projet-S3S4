DROP TABLE IF EXISTS notification_destinataires, notifications, messages, document_lignes, documents, detaildocument, document, clients, salaries, plannings, planning_creneaux, planning_postes, realisations, categories, users;


CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role ENUM('admin','client','salarie') NOT NULL DEFAULT 'client'
);


CREATE TABLE salaries (
  id_salarie INT PRIMARY KEY,
  photo VARCHAR(255) DEFAULT '/public/assets/clients/img/default.png',
  nom_salarie VARCHAR(100) NOT NULL,
  prenom_salarie VARCHAR(100) NOT NULL,
  adresse_salarie VARCHAR(255),
  ville_salarie VARCHAR(100),
  code_postal_salarie VARCHAR(15),
  salaire DECIMAL(10,2),
  date_embauche DATE,
  CONSTRAINT fk_salarie_user FOREIGN KEY (id_salarie) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE clients (
  id_client INT AUTO_INCREMENT PRIMARY KEY,
  photo VARCHAR(255) DEFAULT '/public/assets/clients/img/default.png',
  nom_client VARCHAR(100) NOT NULL,
  prenom_client VARCHAR(100) NOT NULL,
  telephone_client VARCHAR(20),
  adresse_client VARCHAR(255),
  ville_client VARCHAR(100),
  code_postal_client VARCHAR(15),
  siret_client VARCHAR(20),
  user_id INT NULL,
  UNIQUE(user_id), 
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);



CREATE TABLE Document (
    idDoc INT AUTO_INCREMENT PRIMARY KEY,
    num INT,
    nomClient VARCHAR(100),
    telClient VARCHAR(50),
    addrClient VARCHAR(255),
    villeClient VARCHAR(100),
    codePostalClient VARCHAR(20),
    siretClient VARCHAR(20),
    dateDoc DATETIME,
    typeDoc VARCHAR(50),
    statusDoc VARCHAR(50),
    reglementDoc VARCHAR(50),
    datePaiement DATETIME,
    nbRelance INT,
    dateDerniereRelance DATETIME NULL,
    idCli INT,
    FOREIGN KEY (idCli) REFERENCES clients(id_client)
);




CREATE TABLE DetailDocument (
    idLigneDoc INT AUTO_INCREMENT PRIMARY KEY,
    idDoc INT,
    designation VARCHAR(255),
    description VARCHAR(255),
    unite VARCHAR(50),
    quantite INT,
    prixUnitaire DECIMAL(10,2),
    FOREIGN KEY (idDoc) REFERENCES Document(idDoc)
);


CREATE TABLE messages (
  id_message INT AUTO_INCREMENT PRIMARY KEY,
  id_expediteur INT NOT NULL,
  id_destinataire INT NOT NULL,
  message TEXT NOT NULL,
  date_envoi DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_msg_sender FOREIGN KEY (id_expediteur) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT fk_msg_recipient FOREIGN KEY (id_destinataire) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE notifications (
    id_notification INT AUTO_INCREMENT PRIMARY KEY,
    id_destinataire INT NOT NULL,
    id_expediteur INT NULL,
    titre VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    type ENUM('info','success','warning','error') NOT NULL DEFAULT 'info',
    lien VARCHAR(255) NULL,
    is_read TINYINT(1) NOT NULL DEFAULT 0,
    date_lu DATETIME NULL,
    date_creation DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_notif_destinataire
        FOREIGN KEY (id_destinataire)
        REFERENCES users(id)
        ON DELETE CASCADE,
    CONSTRAINT fk_notif_expediteur
        FOREIGN KEY (id_expediteur)
        REFERENCES users(id)
        ON DELETE SET NULL
);



CREATE TABLE notification_destinataires (
  id_notification INT NOT NULL,
  id_destinataire INT NOT NULL,
  lu TINYINT(1) NOT NULL DEFAULT 0,
  date_lu DATETIME NULL,
  PRIMARY KEY (id_notification, id_destinataire),
  CONSTRAINT fk_nd_notif FOREIGN KEY (id_notification) REFERENCES notifications(id_notification) ON DELETE CASCADE,
  CONSTRAINT fk_nd_user FOREIGN KEY (id_destinataire) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE plannings (
  id_planning INT AUTO_INCREMENT PRIMARY KEY,
  nom_planning VARCHAR(100) NOT NULL,
  date_debut DATE NOT NULL,
  date_fin DATE NOT NULL,
  id_manager INT NOT NULL,
  statut ENUM('brouillon','valide','publie') DEFAULT 'brouillon',
  commentaire VARCHAR(255),
  CONSTRAINT fk_planning_manager FOREIGN KEY (id_manager) REFERENCES users(id) ON DELETE CASCADE
);


CREATE TABLE planning_postes (
  id_poste INT AUTO_INCREMENT PRIMARY KEY,
  nom_poste VARCHAR(100) NOT NULL,
  lieu VARCHAR(100),
  description TEXT
);


CREATE TABLE planning_creneaux (
  id_creneau INT AUTO_INCREMENT PRIMARY KEY,
  id_planning INT NOT NULL,
  id_salarie INT NOT NULL,
  date_jour DATE NOT NULL,
  heure_debut TIME NOT NULL,
  heure_fin TIME NOT NULL,
  type_travail ENUM('travail','teletravail','congé','formation') DEFAULT 'travail',
  commentaire VARCHAR(255),
  id_poste INT NULL,
  CONSTRAINT fk_creneau_planning FOREIGN KEY (id_planning) REFERENCES plannings(id_planning) ON DELETE CASCADE,
  CONSTRAINT fk_creneau_salarie FOREIGN KEY (id_salarie) REFERENCES salaries(id_salarie) ON DELETE CASCADE,
  CONSTRAINT fk_creneau_poste FOREIGN KEY (id_poste) REFERENCES planning_postes(id_poste) ON DELETE SET NULL
);


CREATE TABLE categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(255) NOT NULL
);

CREATE TABLE realisations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    photo VARCHAR(255) NOT NULL,
    commentaire TEXT NOT NULL,
    categorie_id INT NOT NULL,
    date_creation DATETIME DEFAULT CURRENT_TIMESTAMP,
    favoris INT DEFAULT 0,
    masque TINYINT(1) NOT NULL DEFAULT 0,
    FOREIGN KEY (categorie_id) REFERENCES categories(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE avis (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    commentaire TEXT,
    note INT CHECK (note >= 1 AND note <= 5),
    date_commentaire DATE NOT NULL,

    CONSTRAINT fk_avis_user
        FOREIGN KEY (user_id) REFERENCES users(id)
        ON DELETE CASCADE
);


CREATE TABLE entreprise (
    nom VARCHAR(255) NOT NULL,
    description TEXT,
    telephone VARCHAR(20),
    adresse VARCHAR(255),
    siret VARCHAR(14) PRIMARY KEY,
    iban VARCHAR(50),
    bic VARCHAR(50)
);


CREATE TABLE conges (
  id_conge INT AUTO_INCREMENT PRIMARY KEY,
  id_salarie INT NOT NULL,
  date_debut DATE NOT NULL,
  date_fin   DATE NOT NULL,
  motif      TEXT,
  statut ENUM('en_attente','accepte','refuse') NOT NULL DEFAULT 'en_attente',
  date_demande   DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  date_decision  DATETIME NULL,
  id_manager_decision INT NULL,
  CONSTRAINT fk_conge_salarie FOREIGN KEY (id_salarie) REFERENCES salaries(id_salarie) ON DELETE CASCADE,
  CONSTRAINT fk_conge_manager FOREIGN KEY (id_manager_decision) REFERENCES users(id) ON DELETE SET NULL
);

CREATE TABLE password_resets (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  token_hash VARCHAR(64) NOT NULL,
  expires_at DATETIME NOT NULL,
  used_at DATETIME DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  INDEX (user_id),
  INDEX (token_hash),
  CONSTRAINT fk_password_resets_user
    FOREIGN KEY (user_id) REFERENCES users(id)
    ON DELETE CASCADE
);



INSERT INTO entreprise (nom, description, telephone, adresse, siret, iban, bic)
VALUES (
    'Team Jardin',
    'Entretien d''espaces verts',
    '0667788990',
    '12 rue des Fleurs, La doua',
    '12345678901234',
    'FR7630006000011234567890187',
    'CMCIFRPP'
);


/* =========================
   USERS (20 CLIENTS + 10 SALARIES dont 2 ADMINS)
   ids forcés pour lier facilement clients/salaries
========================= */

INSERT INTO users (id, username, password, role) VALUES
(1,  'client01',  md5('Client01$2025!'), 'client'),
(2,  'client02',  md5('Client02#R0cks'), 'client'),
(3,  'client03',  md5('Cl!ent03_9x'),   'client'),
(4,  'client04',  md5('C4-client04$'),  'client'),
(5,  'client05',  md5('Cli3nt05-Ok'),   'client'),
(6,  'client06',  md5('C06!secure'),    'client'),
(7,  'client07',  md5('client07_pass#'),'client'),
(8,  'client08',  md5('C8*Purple!7'),   'client'),
(9,  'client09',  md5('9client09$GO'),  'client'),
(10, 'client10',  md5('Client10@Home'), 'client'),
(11, 'client11',  md5('Cli#11-Blue'),   'client'),
(12, 'client12',  md5('C12_sunrise!'),  'client'),
(13, 'client13',  md5('client13^Tree'), 'client'),
(14, 'client14',  md5('Cl14!Moon'),     'client'),
(15, 'client15',  md5('C15-Delta$'),    'client'),
(16, 'client16',  md5('client16+Wave'), 'client'),
(17, 'client17',  md5('C17_River#'),    'client'),
(18, 'client18',  md5('client18?Star'), 'client'),
(19, 'client19',  md5('C19&Stone!'),    'client'),
(20, 'client20',  md5('client20=Leaf'), 'client'),

(21, 'admin1', md5('password123'), 'admin'),
(22, 'admin2', md5('password123'),    'admin'),
(23, 'salarie03', md5('S3_salarie!X'),  'salarie'),
(24, 'salarie04', md5('Sal04@Team'),    'salarie'),
(25, 'salarie05', md5('Salarie05%Go'),  'salarie'),
(26, 'salarie06', md5('Sal06^Lead'),    'salarie'),
(27, 'salarie07', md5('S07_salarie*'),  'salarie'),
(28, 'salarie08', md5('Sal08!Done'),    'salarie'),
(29, 'salarie09', md5('S09#Check'),     'salarie'),
(30, 'salarie10', md5('Sal10$Plan'),    'salarie');


/* =========================
   CLIENTS (20)
   user_id = id users (1..20)
========================= */

INSERT INTO clients (
  id_client, user_id, photo, nom_client, prenom_client, telephone_client,
  adresse_client, ville_client, code_postal_client, siret_client
) VALUES
(1,  1, '/public/assets/clients/img/photo1.png','Durand','Alice','0612345601','12 rue des Lilas','Lyon','69001','FR000001'),
(2,  2, '/public/assets/clients/img/photo1.png','Martin','Bob','0612345602','8 avenue Victor Hugo','Paris','75008','FR000002'),
(3,  3, '/public/assets/clients/img/photo1.png','Lefevre','Claire','0612345603','14 rue Pasteur','Marseille','13001','FR000003'),
(4,  4, '/public/assets/clients/img/photo1.png','Moreau','David','0612345604','6 rue du Parc','Nice','06000','FR000004'),
(5,  5, '/public/assets/clients/img/photo1.png','Garcia','Emma','0612345605','18 rue de la Gare','Bordeaux','33000','FR000005'),
(6,  6, '/public/assets/clients/img/photo1.png','Bernard','Lucas','0612345606','25 avenue Foch','Lille','59000','FR000006'),
(7,  7, '/public/assets/clients/img/photo1.png','Petit','Nora','0612345607','3 place Bellecour','Lyon','69002','FR000007'),
(8,  8, '/public/assets/clients/img/photo1.png','Robert','Hugo','0612345608','4 rue Nationale','Tours','37000','FR000008'),
(9,  9, '/public/assets/clients/img/photo1.png','Richard','Zoé','0612345609','22 avenue République','Dijon','21000','FR000009'),
(10, 10,'/public/assets/clients/img/photo1.png','Dubois','Léo','0612345610','10 chemin du Lac','Annecy','74000','FR000010'),
(11, 11,'/public/assets/clients/img/photo1.png','Laurent','Sarah','0612345611','5 rue des Fleurs','Grenoble','38000','FR000011'),
(12, 12,'/public/assets/clients/img/photo1.png','Simon','Paul','0612345612','45 avenue de la Liberté','Toulouse','31000','FR000012'),
(13, 13,'/public/assets/clients/img/photo1.png','Michel','Eva','0612345613','7 rue Voltaire','Nantes','44000','FR000013'),
(14, 14,'/public/assets/clients/img/photo1.png','Thomas','Olivier','0612345614','9 rue Carnot','Clermont-Ferrand','63000','FR000014'),
(15, 15,'/public/assets/clients/img/photo1.png','Garnier','Inès','0612345615','11 avenue du Stade','Reims','51100','FR000015'),
(16, 16,'/public/assets/clients/img/photo1.png','Faure','Louis','0612345616','2 rue des Peupliers','Caen','14000','FR000016'),
(17, 17,'/public/assets/clients/img/photo1.png','Roux','Chloé','0612345617','17 rue du Moulin','Le Havre','76600','FR000017'),
(18, 18,'/public/assets/clients/img/photo1.png','Fontaine','Maxime','0612345618','15 rue Lafayette','Rouen','76000','FR000018'),
(19, 19,'/public/assets/clients/img/photo1.png','Chevalier','Lina','0612345619','28 rue des Écoles','Nancy','54000','FR000019'),
(20, 20,'/public/assets/clients/img/photo1.png','Lambert','Noah','0612345620','30 rue République','Metz','57000','FR000020');


/* =========================
   SALARIES (10) ids = users 21..30
========================= */

INSERT INTO salaries (id_salarie, nom_salarie, prenom_salarie, adresse_salarie, ville_salarie, code_postal_salarie, salaire, date_embauche)
VALUES
(21, 'Dupont',  'Marie',   '1 rue des Lilas',       'Lyon',       '69001', 2800.00, '2018-03-15'),
(22, 'Durand',  'Pierre',  '2 rue des Roses',       'Paris',      '75012', 3100.00, '2019-06-10'),
(23, 'Bernard', 'Lucie',   '3 avenue du Parc',      'Nice',       '06000', 2900.00, '2017-09-25'),
(24, 'Petit',   'Nicolas', '4 rue République',      'Marseille',  '13001', 3300.00, '2016-11-05'),
(25, 'Robert',  'Sophie',  '5 avenue République',   'Bordeaux',   '33000', 3400.00, '2020-01-12'),
(26, 'Richard', 'Thomas',  '6 rue des Alpes',       'Grenoble',   '38000', 2700.00, '2021-05-22'),
(27, 'Dubois',  'Pauline', '7 rue Nationale',       'Lille',      '59000', 2600.00, '2015-02-01'),
(28, 'Moreau',  'Adrien',  '8 rue Victor Hugo',     'Toulouse',   '31000', 2800.00, '2018-09-17'),
(29, 'Laurent', 'Claire',  '9 rue Lafayette',       'Dijon',      '21000', 3000.00, '2016-12-01'),
(30, 'Simon',   'Hugo',    '10 rue du Stade',       'Lyon',       '69002', 2900.00, '2017-07-30');


/* =========================
   AVIS (ok : utilisateurs 1..10 existent toujours)
========================= */

INSERT INTO avis (user_id, commentaire, note, date_commentaire) VALUES
(1,  'Travail impeccable, mon jardin a complètement changé d’allure !', 5, '2025-01-12'),
(2,  'Très bon contact, équipe professionnelle et ponctuelle.', 5, '2025-01-18'),
(3,  'Résultat satisfaisant mais quelques retards sur le chantier.', 3, '2025-02-03'),
(4,  'Superbes plantations et finitions propres. Je recommande !', 4, '2025-02-10'),
(5,  'Le projet ne correspond pas totalement à mes attentes.', 2, '2025-02-22'),
(6,  'Excellent suivi du début à la fin, rien à redire.', 5, '2025-03-01'),
(7,  'Beau rendu final mais devis révisé à la hausse en cours de route.', 3, '2025-03-05'),
(8,  'Aménagement conforme, propre, mais un peu rapide sur les explications.', 4, '2025-03-12'),
(9,  'Très déçu du résultat, la pelouse n’a pas pris correctement.', 1, '2025-03-20'),
(10, 'Travail sérieux, équipe sympathique et bons conseils.', 4, '2025-03-25');


/* =========================
   CATEGORIES
========================= */

INSERT INTO categories (nom) VALUES
('Aménagement paysager'),
('Entretien de jardin'),
('Plantation d\'arbres et arbustes'),
('Installation de systèmes d\'irrigation'),
('Création de terrasses et allées'),
('Éclairage extérieur');


/* =========================
   REALISATIONS (images remplacées par les tiennes)
   (elles sont "au même endroit", donc on met juste les nouveaux fichiers)
========================= */

INSERT INTO realisations (photo, commentaire, categorie_id) VALUES

('/public/assets/realisation/img/695eef0037501_pexels-creative-vix-7283.jpg',
 'Aménagement paysager complet d’un jardin privé : création de massifs structurés, équilibre des volumes végétaux et mise en valeur de la pelouse.',
 1),

('/public/assets/realisation/img/695ef0c70d8a9_pexels-pixabay-158028.jpg',
 'Création d’une allée de jardin paysagée : tracé du chemin, intégration harmonieuse des plantations et circulation fluide.',
 5),

('/public/assets/realisation/img/695ef3f197901_pexels-dom-j-7304-227391.jpg',
 'Réaménagement d’un grand espace vert : nivellement du terrain et engazonnement pour un rendu uniforme et durable.',
 1),

('/public/assets/realisation/img/695ef3911199b_pexels-andersbk-13975.jpg',
 'Installation d’un éclairage extérieur d’ambiance : mise en valeur du jardin à la tombée de la nuit et sécurisation des accès.',
 6),

('/public/assets/realisation/img/695f565b84f9a_pexels-creative-vix-7283.jpg',
 'Entretien régulier d’un jardin paysager : taille des végétaux, nettoyage des massifs et remise en état générale.',
 2),

('/public/assets/realisation/img/695f714c4b4b6_pexels-andersbk-13975.jpg',
 'Éclairage décoratif du jardin : création d’ambiances lumineuses pour prolonger l’usage des espaces extérieurs en soirée.',
 6),

('/public/assets/realisation/img/695f716bd723b_pexels-dom-j-7304-227391.jpg',
 'Entretien de pelouse et espaces verts : tonte soignée, finitions des bordures et amélioration de la densité du gazon.',
 2),

('/public/assets/realisation/img/695f7135ce463_pexels-pixabay-158028.jpg',
 'Création d’un chemin paysager au cœur du jardin : structuration des circulations et intégration esthétique dans l’environnement.',
 5),

('/public/assets/realisation/img/696c13ed08278.png',
 'Plantation et composition de massifs végétaux : sélection de plantes adaptées, organisation des hauteurs et mise en scène des couleurs.',
 3);

